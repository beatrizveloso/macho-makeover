<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Macho Makeover</title>
  <link rel="icon" href="images/diamante.png">
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      display: flex;
      align-items: center;
      justify-content: space-between;
      background-color: #c950a0;
      height: 100vh;
    }

    #characters,
    #accessories {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }

    .character,
    .accessory {
      width: 100px;
      cursor: pointer;
      user-select: none;
    }

    #avatarCanvas {
      border: 2px dashed pink;
    }

    .canva {
      width: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .save {
      width: 100%;
      height: 60px;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .save button {
      width: 100px;
      height: 40px;
      background-color: pink;
    }

    #accessories {
      width: 100%;
      flex-wrap: wrap;
    }

    #accessories button {
      width: 180px;
      height: 160px;
    }

    #accessories button img {
      width: 180px;
      height: 200px;
    }

    .carousel-container {
      position: absolute;
      top: 50%;
      right: 20px;
      transform: translateY(-50%);
      width: 100%;
      max-width: 500px;
      height: 600px;
      display: flex;
      flex-direction: column;
      align-items: center;
      background: linear-gradient(135deg, #ce4595, #f2b2df);
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      overflow: hidden;
    }

    .arrow {
      font-size: 24px;
      font-weight: bold;
      cursor: pointer;
      user-select: none;
      margin: 10px;
      color: white;
    }

    .arrow:disabled {
      color: #ccc;
      cursor: not-allowed;
    }

    .carousel {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
      overflow: hidden;
      height: 100%;
      scroll-behavior: smooth;
    }

    .carousel-item {
      width: 200px;
      height: 150px;
      display: flex;
      justify-content: center;
      align-items: center;
      background-color: white;
      border-radius: 10px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      cursor: pointer;
    }

    .carousel-item img {
      width: 100px;
      height: 100px;
      object-fit: contain;
    }

    .save button {
      display: flex;
      width: 290px;
      height: 80px;
      border-radius: 80px;
      margin-top: 50px;
      background: none;
      background: linear-gradient(#ec91d1, #940168);
      border: none;
    }

    a {
      background: none;
    }

    h1 {
      font-size: 20px;
      background: none;
      padding-top: 15px;
      padding-left: 40px;
    }

    button img {
      width: 50px;
      padding-top: 15px;
      padding-left: 15px;
      background: none;
    }

    .alinhei {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      width: 50%;
      position: absolute;
      left: 20px;
    }
  </style>
</head>

<body>

  <div class="alinhei">
    <div class="canva">
      <canvas id="avatarCanvas" width="500" height="640"></canvas>
    </div>

    <div class="save">
      <button id="saveAvatar">
        <h1>Salvar Avatar</h1>
        <img src="images/diamante.png" alt="">
      </button>
    </div>
  </div>

  <div class="carousel-container">
    <div class="arrow" id="prevArrow">↑</div>
    <div class="carousel" id="carousel">
      <!-- Itens do carrossel serão adicionados dinamicamente -->
    </div>
    <div class="arrow" id="nextArrow">↓</div>
  </div>

  <script>
    const canvas = document.getElementById('avatarCanvas');
    const ctx = canvas.getContext('2d');
    const objects = [];
    let currentObject = null;
    let isDragging = false;
    let isResizing = false;
    let resizeCorner = null;

    const aquamanImage = new Image();
    aquamanImage.src = 'images/aquaman_base.png';
    aquamanImage.onload = () => {
      objects.push({
        image: aquamanImage,
        x: 0,
        y: 0,
        width: canvas.width,
        height: canvas.height,
        selected: false,
        draggable: false,
        resizable: false
      });
      drawCanvas();
    };

    function drawCanvas() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      objects.forEach(obj => {
        ctx.drawImage(obj.image, obj.x, obj.y, obj.width, obj.height);
        if (obj.selected) {
          drawResizeHandles(obj);
        }
      });
    }

    function drawResizeHandles(obj) {
      const handles = [
        { x: obj.x, y: obj.y },
        { x: obj.x + obj.width, y: obj.y },
        { x: obj.x, y: obj.y + obj.height },
        { x: obj.x + obj.width, y: obj.y + obj.height }
      ];
      ctx.fillStyle = 'blue';
      handles.forEach(handle => {
        ctx.fillRect(handle.x - 5, handle.y - 5, 10, 10);
      });
    }

    function getObjectAtPosition(x, y) {
      for (let i = objects.length - 1; i >= 0; i--) {
        const obj = objects[i];
        const corners = [
          { x: obj.x, y: obj.y, corner: 'tl' },
          { x: obj.x + obj.width, y: obj.y, corner: 'tr' },
          { x: obj.x, y: obj.y + obj.height, corner: 'bl' },
          { x: obj.x + obj.width, y: obj.y + obj.height, corner: 'br' }
        ];

        for (const corner of corners) {
          if (
            x >= corner.x - 5 &&
            x <= corner.x + 5 &&
            y >= corner.y - 5 &&
            y <= corner.y + 5
          ) {
            return { object: obj, resizeCorner: corner.corner };
          }
        }

        if (
          x > obj.x &&
          x < obj.x + obj.width &&
          y > obj.y &&
          y < obj.y + obj.height
        ) {
          return { object: obj, resizeCorner: null };
        }
      }
      return null;
    }

    canvas.addEventListener('drop', (e) => {
      e.preventDefault();
      const src = e.dataTransfer.getData('accessory');
      const img = new Image();
      img.src = src;
      img.onload = () => {
        objects.push({
          image: img,
          x: e.offsetX - img.width / 2,
          y: e.offsetY - img.height / 2,
          width: img.width,
          height: img.height,
          selected: false,
          draggable: true,
          resizable: true
        });
        drawCanvas();
      };
    });

    canvas.addEventListener('dragover', (e) => e.preventDefault());

    canvas.addEventListener('mousedown', (e) => {
      const { offsetX: x, offsetY: y } = e;
      const result = getObjectAtPosition(x, y);

      if (result) {
        currentObject = result.object;
        currentObject.selected = true;
        isResizing = !!result.resizeCorner;
        resizeCorner = result.resizeCorner;
        isDragging = !isResizing;

        objects.splice(objects.indexOf(currentObject), 1);
        objects.push(currentObject);
        drawCanvas();
      } else {
        currentObject = null;
        objects.forEach(obj => (obj.selected = false));
        drawCanvas();
      }
    });

    canvas.addEventListener('mousemove', (e) => {
      if (!currentObject) return;
      const { offsetX: x, offsetY: y } = e;

      if (isDragging) {
        currentObject.x = x - currentObject.width / 2;
        currentObject.y = y - currentObject.height / 2;
        drawCanvas();
      } else if (isResizing) {
        switch (resizeCorner) {
          case 'tl':
            currentObject.width += currentObject.x - x;
            currentObject.height += currentObject.y - y;
            currentObject.x = x;
            currentObject.y = y;
            break;
          case 'tr':
            currentObject.width = x - currentObject.x;
            currentObject.height += currentObject.y - y;
            currentObject.y = y;
            break;
          case 'bl':
            currentObject.width += currentObject.x - x;
            currentObject.height = y - currentObject.y;
            currentObject.x = x;
            break;
          case 'br':
            currentObject.width = x - currentObject.x;
            currentObject.height = y - currentObject.y;
            break;
        }
        drawCanvas();
      }
    });

    canvas.addEventListener('mouseup', () => {
      isDragging = false;
      isResizing = false;
      resizeCorner = null;
    });

    document.getElementById('saveAvatar').addEventListener('click', () => {
      const link = document.createElement('a');
      link.download = 'macho.png';
      link.href = canvas.toDataURL();
      link.click();
    });

    const carousel = document.getElementById('carousel');
    const prevArrow = document.getElementById('prevArrow');
    const nextArrow = document.getElementById('nextArrow');

    const accessories = [
      "images/oculos-rose-glitter.png",
      "images/oculos-brown.png",
      "images/juliete.png",
      "images/oculos-blue-pink.png",
      "images/cachecol-rosa.png",
      "images/bag-pink.png",
      "images/mini-bag-pink.png",
      "images/vestido-cereja.png",
      "images/short-bege.png",
      "images/laço-rosa.png",
      "images/oculos-rose-glitter.png",
      "images/cachecol-rosa.png",
      "images/oculos-blue-pink.png",
      "images/bag-pink.png"
    ];

    function renderItems() {
      carousel.innerHTML = "";
      accessories.forEach((src) => {
        const item = document.createElement("div");
        item.classList.add("carousel-item");

        const img = document.createElement("img");
        img.src = src;
        img.alt = "Acessório";
        item.appendChild(img);

        item.addEventListener("click", () => {
          alert(`Acessório selecionado: ${src}`);
        });

        carousel.appendChild(item);
      });
    }

    let scrollPosition = 0;
    const scrollStep = 300;

    prevArrow.addEventListener("click", () => {
      scrollPosition = Math.max(scrollPosition - scrollStep, 0);
      carousel.scrollTo({ top: scrollPosition, behavior: "smooth" });
    });

    nextArrow.addEventListener("click", () => {
      scrollPosition = Math.min(
        scrollPosition + scrollStep,
        carousel.scrollHeight - carousel.clientHeight
      );
      carousel.scrollTo({ top: scrollPosition, behavior: "smooth" });
    });

    renderItems();
  </script>

</body>

</html>
