<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Macho Makeover</title>
  <link rel="icon" href="images/diamante.png">
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      display: flex;
      align-items: center;
      justify-content: space-between;
      background-color: #c950a0;
      height: 100vh;
    }

    #characters,
    #accessories {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }

    .character,
    .accessory {
      width: 100px;
      cursor: pointer;
      user-select: none;
    }

    #avatarCanvas {
      border: 2px dashed pink;
      max-width: 100%;
      max-height: 100%;
    }

    .canva {
      width: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .save {
      width: 100%;
      height: 60px;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .save button {
      width: 100px;
      height: 40px;
      background-color: pink;
    }

    #accessories {
      width: 100%;
      flex-wrap: wrap;
    }

    #accessories button {
      width: 180px;
      height: 160px;
    }

    #accessories button img {
      width: 180px;
      height: 200px;
    }

    .carousel-container {
      position: absolute;
      top: 50%;
      right: 20px;
      transform: translateY(-50%);
      width: 100%;
      max-width: 500px;
      height: 600px;
      display: flex;
      flex-direction: column;
      align-items: center;
      background: linear-gradient(135deg, #ce4595, #f2b2df);
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      overflow: hidden;
    }

    .arrow {
      font-size: 24px;
      font-weight: bold;
      cursor: pointer;
      user-select: none;
      margin: 10px;
      color: white;
    }

    .arrow:disabled {
      color: #ccc;
      cursor: not-allowed;
    }

    .carousel {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
      overflow: hidden;
      height: 100%;
      scroll-behavior: smooth;
    }

    .carousel-item {
      width: 200px;
      height: 150px;
      display: flex;
      justify-content: center;
      align-items: center;
      background-color: white;
      border-radius: 10px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      cursor: pointer;
    }

    .carousel-item img {
      width: 100px;
      height: 100px;
      object-fit: contain;
    }

    .save button {
      display: flex;
      width: 290px;
      height: 80px;
      border-radius: 80px;
      margin-top: 50px;
      background: none;
      background: linear-gradient(#ec91d1, #940168);
      border: none;
    }

    a {
      background: none;
    }

    h1 {
      font-size: 20px;
      background: none;
      padding-top: 15px;
      padding-left: 40px;
    }

    button img {
      width: 50px;
      padding-top: 15px;
      padding-left: 15px;
      background: none;
    }

    .alinhei {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      width: 50%;
      position: absolute;
      left: 20px;
    }

    .tabs-container {
      display: flex;
      align-items: center;
      margin-bottom: 20px;
    }

    .tabs {
      display: flex;
      justify-content: center;
    }

    .tab {
      padding: 10px 20px;
      margin: 0 5px;
      background-color: #ddd;
      border: 1px solid #ccc;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
    }

    .tab.active {
      background-color: #d64499;
      color: white;
    }
  </style>
</head>

<body>

  <div class="alinhei">
    <div class="canva">
      <canvas id="avatarCanvas" width="500" height="600"></canvas>
    </div>

    <div class="save">
      <button id="saveAvatar">
        <h1>Salvar Avatar</h1>
        <img src="images/diamante.png" alt="">
      </button>
    </div>
  </div>

  <div class="carousel-container">
    <div class="tabs-container">
      <div class="tabs">
        <div class="tab active" data-category="oculos">Óculos</div>
        <div class="tab" data-category="bolsas">Bolsas</div>
        <div class="tab" data-category="lacos">Laços</div>
      </div>
    </div>
    <div class="arrow" id="prevArrow">↑</div>
    <div class="carousel" id="carousel">
      <!-- Itens do carrossel serão adicionados dinamicamente -->
    </div>
    <div class="arrow" id="nextArrow">↓</div>
  </div>

  <script>

    // Seleciona o botão e o canvas
    const saveButton = document.getElementById("saveAvatar"); // Seleciona o botão com id "saveAvatar"
    const canvas = document.getElementById("avatarCanvas"); // Seleciona o canvas com id "avatarCanvas"
    const ctx = canvas.getContext("2d"); // Obtém o contexto 2D do canvas, necessário para desenhar nele
    
    // Adiciona o evento de clique ao botão
    saveButton.addEventListener("click", () => {
      // Converte o conteúdo do canvas em uma URL de imagem PNG
      const image = canvas.toDataURL("image/png");
    
      // Cria um elemento de link temporário para download
      const link = document.createElement("a");
      link.href = image;
      link.download = "macho.png"; // Nome do arquivo salvo
      link.click(); // Dispara o clique no link
    });
    
    // Elementos do Canvas
    const aquamanImage = new Image(); // Cria um novo objeto de imagem para o personagem Aquaman
    aquamanImage.src = "images/aquaman_base.png"; // Define o caminho da imagem do personagem
    
    // Array para armazenar acessórios adicionados
    const accessoryImages = []; // Array onde serão armazenados os acessórios adicionados ao avatar
    let selectedAccessory = null; // Acessório atualmente selecionado para ajuste
    let resizing = null; // Indica se está redimensionando (qual canto)
    let isDragging = false; // Verifica se o mouse está pressionado
    
    // Função para desenhar Aquaman e acessórios no canvas
    function drawAquaman() {
      const canvasWidth = canvas.width; // Obtém a largura do canvas
      const canvasHeight = canvas.height; // Obtém a altura do canvas
    
      const scaleX = canvasWidth / aquamanImage.width; // Calcula a escala horizontal
      const scaleY = canvasHeight / aquamanImage.height; // Calcula a escala vertical
      const scale = Math.min(scaleX, scaleY); // Usa a menor escala para manter a proporção
    
      const newWidth = aquamanImage.width * scale; // Calcula a nova largura do Aquaman com a escala
      const newHeight = aquamanImage.height * scale; // Calcula a nova altura do Aquaman com a escala
    
      ctx.clearRect(0, 0, canvasWidth, canvasHeight); // Limpa o canvas
      ctx.drawImage(
        aquamanImage,
        (canvasWidth - newWidth) / 2,
        (canvasHeight - newHeight) / 2,
        newWidth,
        newHeight
      ); // Desenha a imagem do Aquaman centralizada no canvas
    
      // Desenha os acessórios adicionados
      accessoryImages.forEach(({ img, x, y, width, height }) => {
        ctx.drawImage(img, x, y, width, height); // Desenha cada acessório na posição especificada
    
        // Desenha marcadores somente no acessório selecionado
        if (selectedAccessory && selectedAccessory.img === img) {
          ctx.fillStyle = "rgba(0, 0, 255, 0.5)"; // Define a cor de preenchimento para os marcadores
          const corners = [
            { x: x - 5, y: y - 5 }, // Superior esquerdo
            { x: x + width - 5, y: y - 5 }, // Superior direito
            { x: x - 5, y: y + height - 5 }, // Inferior esquerdo
            { x: x + width - 5, y: y + height - 5 }, // Inferior direito
          ];
          corners.forEach(({ x, y }) => ctx.fillRect(x, y, 10, 10)); // Desenha os marcadores
        }
      });
    }
    
    // Função para adicionar um acessório ao canvas
    function addAccessory(imageSrc) {
      const accessoryImage = new Image(); // Cria um novo objeto de imagem para o acessório
      accessoryImage.src = imageSrc; // Define o caminho da imagem do acessório
    
      accessoryImage.onload = () => {
        const width = 100; // Tamanho inicial do acessório
        const height = 100; // Tamanho inicial do acessório
        const x = (canvas.width - width) / 2; // Posição inicial do acessório no centro horizontal
        const y = (canvas.height - height) / 2; // Posição inicial do acessório no centro vertical
    
        accessoryImages.push({ img: accessoryImage, x, y, width, height }); // Adiciona o acessório ao array
        drawAquaman(); // Redesenha o avatar com o novo acessório
      };
    }
    
    // Detecta qual canto está sendo clicado
    function detectCorner(x, y, acc) {
      const cornerSize = 10; // Tamanho dos cantos para detectar redimensionamento
      const corners = [
        { name: "top-left", x: acc.x, y: acc.y },
        { name: "top-right", x: acc.x + acc.width, y: acc.y },
        { name: "bottom-left", x: acc.x, y: acc.y + acc.height },
        { name: "bottom-right", x: acc.x + acc.width, y: acc.y + acc.height },
      ];
      return corners.find(
        (corner) =>
          x >= corner.x - cornerSize &&
          x <= corner.x + cornerSize &&
          y >= corner.y - cornerSize &&
          y <= corner.y + cornerSize
      ); // Retorna o canto clicado
    }
    
    // Eventos de interação no canvas para mover e redimensionar acessórios
    canvas.addEventListener("mousedown", (event) => {
      const { offsetX, offsetY } = event; // Posições de clique no canvas
    
      // Verifica se está clicando em um canto
      selectedAccessory = accessoryImages.find((acc) => detectCorner(offsetX, offsetY, acc));
      if (selectedAccessory) {
        resizing = detectCorner(offsetX, offsetY, selectedAccessory).name; // Define qual canto está sendo redimensionado
        isDragging = true; // Inicia o movimento/redimensionamento
        return;
      }
    
      // Seleciona o item para mover
      selectedAccessory = accessoryImages.find(
        ({ x, y, width, height }) =>
          offsetX >= x && offsetX <= x + width && offsetY >= y && offsetY <= y + height
      ); // Verifica se o clique está dentro de algum acessório
    
      if (selectedAccessory) {
        isDragging = true; // Inicia o movimento
      }
    
      drawAquaman(); // Atualiza o desenho ao selecionar
    });
    
    canvas.addEventListener("mousemove", (event) => {
      if (isDragging && selectedAccessory) {
        const { offsetX, offsetY } = event;
    
        if (resizing) {
          // Redimensiona o acessório baseado no canto
          if (resizing === "top-left") {
            selectedAccessory.width += selectedAccessory.x - offsetX;
            selectedAccessory.height += selectedAccessory.y - offsetY;
            selectedAccessory.x = offsetX;
            selectedAccessory.y = offsetY;
          } else if (resizing === "top-right") {
            selectedAccessory.width = offsetX - selectedAccessory.x;
            selectedAccessory.height += selectedAccessory.y - offsetY;
            selectedAccessory.y = offsetY;
          } else if (resizing === "bottom-left") {
            selectedAccessory.width += selectedAccessory.x - offsetX;
            selectedAccessory.height = offsetY - selectedAccessory.y;
            selectedAccessory.x = offsetX;
          } else if (resizing === "bottom-right") {
            selectedAccessory.width = offsetX - selectedAccessory.x;
            selectedAccessory.height = offsetY - selectedAccessory.y;
          }
        } else {
          // Move o acessório
          selectedAccessory.x = offsetX - selectedAccessory.width / 2;
          selectedAccessory.y = offsetY - selectedAccessory.height / 2;
        }
    
        drawAquaman(); // Atualiza o desenho ao mover ou redimensionar
      }
    });
    
    canvas.addEventListener("mouseup", () => {
      isDragging = false; // Finaliza o movimento
      resizing = null; // Finaliza o redimensionamento
    });
    
    // Remove seleção ao clicar fora do canvas
    document.addEventListener("click", (event) => {
      if (!canvas.contains(event.target)) {
        selectedAccessory = null; // Remove a seleção
        resizing = null;
        isDragging = false;
        drawAquaman(); // Atualiza o desenho
      }
    });
    
    // Evento para deletar o item selecionado
    document.addEventListener("keydown", (event) => {
      if (event.key === "Delete" && selectedAccessory) {
        const index = accessoryImages.indexOf(selectedAccessory); // Encontra o índice do acessório
        if (index !== -1) {
          accessoryImages.splice(index, 1); // Remove o acessório do array
        }
        selectedAccessory = null; // Remove a seleção
        drawAquaman(); // Atualiza o desenho
      }
    });
    
    // Inicializa o desenho do Aquaman no canvas
    aquamanImage.onload = drawAquaman;
    
    // Gerenciamento de categorias e itens do carrossel
    const tabs = document.querySelectorAll(".tab"); // Seleciona as abas de categorias
    const carousel = document.getElementById("carousel"); // Seleciona o carrossel de itens
    
    const items = {
      oculos: [
        "images/oculos-rose-glitter.png",
        "images/oculos-brown.png",
        "images/juliete.png",
        "images/oculos-blue-pink.png",
        "images/cachecol-rosa.png",
      ],
      bolsas: [
        "images/bag-pink.png",
        "images/mini-bag-pink.png",
        "images/vestido-cereja.png",
        "images/short-bege.png",
        "images/cachecol-rosa.png",
      ],
      lacos: [
        "images/laço-rosa.png",
        "images/cachecol-rosa.png",
        "images/oculos-blue-pink.png",
        "images/oculos-rose-glitter.png",
        "images/short-bege.png",
      ],
    };
    
    let currentIndex = 0; // Índice atual da categoria ativa
    
    // Função para renderizar os itens de uma categoria no carrossel
    function renderItems(category) {
      const categoryItems = items[category]; // Obtém os itens da categoria
      carousel.innerHTML = ""; // Limpa itens anteriores
    
      categoryItems.forEach((imageSrc) => {
        const item = document.createElement("div");
        item.classList.add("carousel-item"); // Adiciona a classe de item ao elemento
    
        const img = document.createElement("img");
        img.src = imageSrc; // Define o caminho da imagem do acessório
        img.alt = "Acessório"; // Define o texto alternativo para a imagem
        item.appendChild(img); // Adiciona a imagem ao item
    
        item.addEventListener("click", () => {
          addAccessory(imageSrc); // Adiciona o acessório ao canvas
        });
    
        carousel.appendChild(item); // Adiciona o item ao carrossel
      });
    }
    
    // Função para atualizar as abas de categorias
    function updateTabs() {
      tabs.forEach((tab, index) => {
        tab.classList.toggle("active", index === currentIndex); // Marca a aba ativa
      });
    
      const category = tabs[currentIndex].dataset.category; // Obtém a categoria da aba ativa
      renderItems(category); // Renderiza os itens da categoria
    }
    
    tabs.forEach((tab, index) => {
      tab.addEventListener("click", () => {
        currentIndex = index; // Define a nova categoria ativa
        updateTabs(); // Atualiza as abas e os itens
      });
    });
    
    // Inicializa a primeira categoria no carrossel
    updateTabs();
    </script>
    

</body>

</html>